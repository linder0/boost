'use client'

import { useRef, useEffect, useState, useCallback } from 'react'
import { createMarkerElement } from './map-marker-label'

// NYC Neighborhood boundaries (real polygon data from NYC Open Data)
const NYC_NEIGHBORHOOD_BOUNDS: Record<string, {
  center: [number, number]
  coordinates: [number, number][]
  color: string
}> = {
  'Tribeca': {
    center: [-74.012152, 40.720388],
    coordinates: [[-74.001886, 40.719395], [-74.003533, 40.717449], [-74.008614, 40.711372], [-74.013754, 40.713690], [-74.012440, 40.719058], [-74.013036, 40.719086], [-74.013031, 40.719131], [-74.012961, 40.719484], [-74.012914, 40.719708], [-74.012945, 40.719713], [-74.012946, 40.719697], [-74.013026, 40.719709], [-74.013024, 40.719726], [-74.013445, 40.719782], [-74.013447, 40.719782], [-74.013399, 40.720032], [-74.016390, 40.720379], [-74.016315, 40.720739], [-74.013963, 40.720464], [-74.012966, 40.720329], [-74.012964, 40.720335], [-74.012869, 40.720834], [-74.013239, 40.720888], [-74.015695, 40.721220], [-74.015626, 40.721551], [-74.013138, 40.721251], [-74.013080, 40.721546], [-74.013044, 40.721545], [-74.013010, 40.721560], [-74.012544, 40.721504], [-74.012540, 40.721503], [-74.012539, 40.721503], [-74.012504, 40.721672], [-74.012492, 40.721780], [-74.011965, 40.724332], [-74.011376, 40.724280], [-74.011060, 40.725744], [-74.008302, 40.723977], [-74.001886, 40.719395]],
    color: '#ef4444',
  },
  'SoHo': {
    center: [-74.007126, 40.725506],
    coordinates: [[-74.002856, 40.728347], [-73.997635, 40.725786], [-73.996772, 40.725432], [-73.995395, 40.725004], [-73.996661, 40.723467], [-73.997124, 40.722290], [-73.997670, 40.720820], [-73.999991, 40.717977], [-74.001886, 40.719395], [-74.008302, 40.723977], [-74.011060, 40.725744], [-74.011376, 40.724280], [-74.011965, 40.724332], [-74.011963, 40.724342], [-74.011653, 40.725872], [-74.011660, 40.725873], [-74.011958, 40.725978], [-74.012316, 40.726034], [-74.015163, 40.726320], [-74.015204, 40.726362], [-74.015124, 40.726794], [-74.011542, 40.726447], [-74.011383, 40.728229], [-74.010799, 40.728196], [-74.010659, 40.729832], [-74.009208, 40.729706], [-74.009350, 40.728988], [-74.002856, 40.728347]],
    color: '#f97316',
  },
  'West Village': {
    center: [-74.011020, 40.737405],
    coordinates: [[-74.008810, 40.742378], [-73.996797, 40.737364], [-74.001413, 40.731065], [-74.002856, 40.728347], [-74.009350, 40.728988], [-74.009208, 40.729706], [-74.010659, 40.729832], [-74.010799, 40.728196], [-74.011383, 40.728229], [-74.014391, 40.728463], [-74.014345, 40.728622], [-74.014077, 40.730640], [-74.014087, 40.730663], [-74.014038, 40.730694], [-74.014016, 40.730683], [-74.011163, 40.730451], [-74.011162, 40.730451], [-74.011068, 40.731545], [-74.010984, 40.732522], [-74.010941, 40.733020], [-74.011660, 40.733032], [-74.014002, 40.733068], [-74.014000, 40.733332], [-74.014000, 40.733332], [-74.010904, 40.733298], [-74.010903, 40.733298], [-74.010870, 40.733593], [-74.010833, 40.734007], [-74.012018, 40.734064], [-74.012001, 40.734338], [-74.012001, 40.734338], [-74.010827, 40.734284], [-74.010814, 40.734283], [-74.010643, 40.736049], [-74.010677, 40.736056], [-74.010670, 40.736102], [-74.010688, 40.736114], [-74.010704, 40.736129], [-74.010717, 40.736146], [-74.010726, 40.736165], [-74.010731, 40.736184], [-74.010732, 40.736204], [-74.010728, 40.736224], [-74.010720, 40.736243], [-74.010709, 40.736260], [-74.010694, 40.736276], [-74.010676, 40.736290], [-74.010655, 40.736301], [-74.010654, 40.736348], [-74.010619, 40.736345], [-74.010477, 40.738064], [-74.011087, 40.738093], [-74.011068, 40.738304], [-74.011089, 40.738318], [-74.011107, 40.738333], [-74.011121, 40.738351], [-74.011132, 40.738370], [-74.011139, 40.738390], [-74.011116, 40.738392], [-74.011092, 40.738392], [-74.011054, 40.738388], [-74.011051, 40.738396], [-74.010454, 40.738365], [-74.010393, 40.739174], [-74.010499, 40.739173], [-74.010555, 40.739186], [-74.010747, 40.739176], [-74.011388, 40.739216], [-74.011485, 40.739260], [-74.011580, 40.739265], [-74.011588, 40.739272], [-74.011587, 40.739479], [-74.011634, 40.739506], [-74.011628, 40.739562], [-74.011555, 40.739557], [-74.011527, 40.739874], [-74.011593, 40.739874], [-74.011613, 40.739708], [-74.011616, 40.739708], [-74.012348, 40.739738], [-74.012369, 40.739752], [-74.012374, 40.739779], [-74.012349, 40.739794], [-74.012286, 40.739793], [-74.012289, 40.739899], [-74.012314, 40.739903], [-74.012343, 40.739921], [-74.012357, 40.739937], [-74.012349, 40.740016], [-74.012324, 40.740031], [-74.012270, 40.740034], [-74.012263, 40.740142], [-74.012309, 40.740148], [-74.012329, 40.740163], [-74.012330, 40.740183], [-74.012310, 40.740195], [-74.011577, 40.740160], [-74.011586, 40.739974], [-74.011515, 40.739973], [-74.011461, 40.740584], [-74.012157, 40.740606], [-74.012154, 40.740674], [-74.012657, 40.740697], [-74.012659, 40.740748], [-74.011475, 40.740687], [-74.011374, 40.740724], [-74.009631, 40.740645], [-74.009497, 40.740727], [-74.009492, 40.740743], [-74.009516, 40.740774], [-74.009518, 40.740806], [-74.009463, 40.740902], [-74.009411, 40.741154], [-74.009585, 40.741175], [-74.009577, 40.741211], [-74.012162, 40.741492], [-74.012119, 40.741749], [-74.012117, 40.741759], [-74.009527, 40.741491], [-74.009519, 40.741490], [-74.009448, 40.741892], [-74.009447, 40.741892], [-74.009278, 40.741879], [-74.009161, 40.742509], [-74.008810, 40.742378]],
    color: '#eab308',
  },
  'East Village': {
    center: [-73.979482, 40.725476],
    coordinates: [[-73.990704, 40.734782], [-73.982554, 40.731375], [-73.982553, 40.731375], [-73.971629, 40.726761], [-73.971630, 40.726760], [-73.971768, 40.725833], [-73.971774, 40.725821], [-73.971791, 40.725814], [-73.971817, 40.725815], [-73.972188, 40.724045], [-73.972852, 40.721247], [-73.973383, 40.719189], [-73.973513, 40.718775], [-73.973576, 40.718589], [-73.974739, 40.718801], [-73.975452, 40.718947], [-73.977224, 40.719310], [-73.978753, 40.719934], [-73.992604, 40.724136], [-73.991285, 40.727762], [-73.990757, 40.729741], [-73.992854, 40.730083], [-73.991460, 40.731738], [-73.990704, 40.734782]],
    color: '#84cc16',
  },
  'Chelsea': {
    center: [-74.008900, 40.747798],
    coordinates: [[-73.993464, 40.752190], [-73.987937, 40.749855], [-73.987933, 40.749853], [-73.987973, 40.749467], [-73.991356, 40.744763], [-73.994211, 40.741013], [-73.989777, 40.739169], [-73.990371, 40.737098], [-73.991725, 40.735245], [-73.996797, 40.737364], [-74.008810, 40.742378], [-74.009161, 40.742509], [-74.009092, 40.742886], [-74.009240, 40.742900], [-74.009620, 40.742951], [-74.009620, 40.742952], [-74.009568, 40.743258], [-74.009585, 40.743264], [-74.012119, 40.743517], [-74.012137, 40.743532], [-74.012148, 40.743559], [-74.012090, 40.743898], [-74.012069, 40.743922], [-74.012021, 40.743940], [-74.009512, 40.743676], [-74.009489, 40.743696], [-74.009438, 40.743971], [-74.009394, 40.743969], [-74.008900, 40.743918], [-74.008730, 40.744882], [-74.009105, 40.744931], [-74.009612, 40.744998], [-74.009558, 40.745289], [-74.009917, 40.745327], [-74.009934, 40.745317], [-74.009998, 40.744955], [-74.009987, 40.744944], [-74.009869, 40.744934], [-74.009872, 40.744917], [-74.010168, 40.744942], [-74.010165, 40.744964], [-74.010054, 40.744954], [-74.010038, 40.744963], [-74.009974, 40.745323], [-74.009991, 40.745337], [-74.010469, 40.745387], [-74.010488, 40.745376], [-74.010550, 40.745013], [-74.010532, 40.745003], [-74.010417, 40.744994], [-74.010419, 40.744977], [-74.010764, 40.745005], [-74.010762, 40.745024], [-74.010606, 40.745011], [-74.010586, 40.745020], [-74.010531, 40.745382], [-74.010545, 40.745392], [-74.011104, 40.745448], [-74.011116, 40.745436], [-74.011172, 40.745078], [-74.011153, 40.745069], [-74.011043, 40.745061], [-74.011045, 40.745046], [-74.011388, 40.745073], [-74.011386, 40.745088], [-74.011230, 40.745076], [-74.011154, 40.745446], [-74.011167, 40.745460], [-74.011740, 40.745520], [-74.011795, 40.745155], [-74.011783, 40.745135], [-74.011669, 40.745127], [-74.011671, 40.745114], [-74.011836, 40.745126], [-74.011766, 40.745578], [-74.011783, 40.745602], [-74.011719, 40.745940], [-74.011711, 40.745961], [-74.011679, 40.745979], [-74.011635, 40.745978], [-74.010555, 40.745871], [-74.010551, 40.745903], [-74.010128, 40.745857], [-74.010128, 40.745842], [-74.009947, 40.745817], [-74.009948, 40.745800], [-74.009464, 40.745750], [-74.009366, 40.746337], [-74.011528, 40.746575], [-74.011562, 40.746587], [-74.011585, 40.746609], [-74.011582, 40.746636], [-74.011525, 40.746973], [-74.011479, 40.746985], [-74.011476, 40.746997], [-74.009243, 40.746763], [-74.009137, 40.747360], [-74.009560, 40.747403], [-74.009550, 40.747371], [-74.009552, 40.747339], [-74.009964, 40.747378], [-74.009958, 40.747412], [-74.009902, 40.747438], [-74.011357, 40.747592], [-74.011395, 40.747611], [-74.011407, 40.747631], [-74.011407, 40.747631], [-74.011347, 40.747976], [-74.011332, 40.748001], [-74.011304, 40.748015], [-74.011266, 40.748014], [-74.009058, 40.747786], [-74.008946, 40.748412], [-74.008979, 40.748413], [-74.008979, 40.748400], [-74.009071, 40.748410], [-74.009074, 40.748395], [-74.009415, 40.748430], [-74.009416, 40.748437], [-74.009523, 40.748448], [-74.009519, 40.748474], [-74.011167, 40.748645], [-74.011195, 40.748657], [-74.011216, 40.748678], [-74.011216, 40.748697], [-74.011149, 40.749026], [-74.011133, 40.749042], [-74.011109, 40.749050], [-74.011078, 40.749052], [-74.009994, 40.748937], [-74.009948, 40.748932], [-74.009560, 40.749935], [-74.009723, 40.749972], [-74.009728, 40.749964], [-74.010192, 40.750109], [-74.010808, 40.750319], [-74.010757, 40.750411], [-74.009683, 40.750063], [-74.009694, 40.750044], [-74.009542, 40.750001], [-74.009518, 40.750107], [-74.009253, 40.749985], [-74.009119, 40.750332], [-74.010674, 40.751072], [-74.010591, 40.751323], [-74.009001, 40.750648], [-74.008735, 40.751349], [-74.008731, 40.751466], [-74.008667, 40.751628], [-74.008533, 40.751884], [-74.008760, 40.751948], [-74.009078, 40.752069], [-74.010217, 40.752548], [-74.010125, 40.752669], [-74.008997, 40.752189], [-74.008915, 40.752164], [-74.008591, 40.752028], [-74.008581, 40.752044], [-74.009341, 40.752356], [-74.009328, 40.752374], [-74.008479, 40.752019], [-74.008426, 40.752158], [-74.009991, 40.752816], [-74.009920, 40.752912], [-74.009971, 40.752934], [-74.009919, 40.753004], [-74.009789, 40.752948], [-74.009888, 40.752814], [-74.009839, 40.752795], [-74.009831, 40.752803], [-74.008830, 40.752380], [-74.008836, 40.752372], [-74.008792, 40.752352], [-74.008688, 40.752494], [-74.008354, 40.752351], [-74.007811, 40.753779], [-74.007761, 40.753910], [-74.007620, 40.754281], [-74.007745, 40.754337], [-74.007597, 40.754530], [-74.007472, 40.754477], [-74.007285, 40.754736], [-74.007414, 40.754789], [-74.007272, 40.754986], [-74.007145, 40.754932], [-74.006394, 40.755972], [-74.005567, 40.757118], [-74.004927, 40.757023], [-73.993464, 40.752190]],
    color: '#22c55e',
  },
  'Flatiron': {
    center: [-73.987144, 40.740337],
    coordinates: [[-73.983381, 40.741375], [-73.984742, 40.739503], [-73.984743, 40.739502], [-73.985232, 40.738833], [-73.986875, 40.739522], [-73.987743, 40.738311], [-73.989777, 40.739169], [-73.994211, 40.741013], [-73.991356, 40.744763], [-73.983381, 40.741375]],
    color: '#14b8a6',
  },
  'Gramercy': {
    center: [-73.984571, 40.736509],
    coordinates: [[-73.978527, 40.736855], [-73.982022, 40.732012], [-73.982553, 40.731375], [-73.982554, 40.731375], [-73.990704, 40.734782], [-73.991725, 40.735245], [-73.990371, 40.737098], [-73.989777, 40.739169], [-73.987743, 40.738311], [-73.986875, 40.739522], [-73.985232, 40.738833], [-73.984743, 40.739502], [-73.984742, 40.739503], [-73.978520, 40.736858], [-73.978527, 40.736856], [-73.978527, 40.736855]],
    color: '#06b6d4',
  },
  'Midtown': {
    center: [-73.979019, 40.758724],
    coordinates: [[-73.962231, 40.754522], [-73.967919, 40.747961], [-73.979287, 40.752801], [-73.982955, 40.747744], [-73.979711, 40.746385], [-73.983381, 40.741375], [-73.991356, 40.744763], [-73.987973, 40.749467], [-73.987933, 40.749853], [-73.993464, 40.752190], [-73.990724, 40.755950], [-73.985043, 40.753554], [-73.979057, 40.761747], [-73.984726, 40.764167], [-73.982389, 40.767411], [-73.982156, 40.767756], [-73.982321, 40.767894], [-73.982385, 40.768097], [-73.982268, 40.768299], [-73.982039, 40.768388], [-73.981754, 40.768400], [-73.981565, 40.768307], [-73.981468, 40.768150], [-73.981451, 40.767983], [-73.981150, 40.767754], [-73.973015, 40.764279], [-73.958788, 40.758213], [-73.959181, 40.757856], [-73.960656, 40.755923], [-73.962231, 40.754522]],
    color: '#3b82f6',
  },
  'Upper East Side': {
    center: [-73.946648, 40.775407],
    coordinates: [[-73.943592, 40.782748], [-73.943648, 40.782656], [-73.943871, 40.781273], [-73.943459, 40.780048], [-73.943214, 40.779318], [-73.943004, 40.779639], [-73.942716, 40.779544], [-73.942712, 40.779215], [-73.942536, 40.779091], [-73.942893, 40.778614], [-73.942438, 40.777315], [-73.942245, 40.777104], [-73.942074, 40.776918], [-73.942003, 40.776185], [-73.942620, 40.775181], [-73.942856, 40.774797], [-73.942930, 40.774676], [-73.945871, 40.771692], [-73.946619, 40.770933], [-73.948664, 40.768858], [-73.950070, 40.767025], [-73.954418, 40.762184], [-73.956508, 40.760285], [-73.958788, 40.758213], [-73.973015, 40.764279], [-73.955760, 40.787907], [-73.944023, 40.782960], [-73.943592, 40.782748]],
    color: '#6366f1',
  },
  'Upper West Side': {
    center: [-73.987777, 40.780342],
    coordinates: [[-73.958358, 40.800369], [-73.981439, 40.768763], [-73.981549, 40.768559], [-73.981565, 40.768307], [-73.981754, 40.768400], [-73.982039, 40.768388], [-73.982268, 40.768299], [-73.982385, 40.768097], [-73.982321, 40.767894], [-73.982156, 40.767756], [-73.982389, 40.767411], [-73.993650, 40.772146], [-73.994159, 40.772493], [-73.993831, 40.772932], [-73.993891, 40.772955], [-73.993963, 40.772945], [-73.994013, 40.772883], [-73.994122, 40.772924], [-73.994137, 40.772902], [-73.994301, 40.772970], [-73.994282, 40.772994], [-73.994377, 40.773040], [-73.994294, 40.773156], [-73.995023, 40.773481], [-73.995089, 40.773388], [-73.995014, 40.773358], [-73.995050, 40.773297], [-73.996241, 40.773790], [-73.996196, 40.773852], [-73.996099, 40.773952], [-73.996179, 40.773987], [-73.996095, 40.774086], [-73.995572, 40.773871], [-73.994017, 40.773214], [-73.993936, 40.773180], [-73.993862, 40.773270], [-73.993822, 40.773382], [-73.993767, 40.773484], [-73.993698, 40.773562], [-73.993358, 40.773927], [-73.992623, 40.774974], [-73.992578, 40.774956], [-73.992528, 40.775002], [-73.992470, 40.775024], [-73.992404, 40.775018], [-73.992267, 40.775116], [-73.992178, 40.775279], [-73.992059, 40.775498], [-73.992125, 40.775509], [-73.992227, 40.775482], [-73.992329, 40.775469], [-73.992362, 40.775502], [-73.992386, 40.775557], [-73.992088, 40.775984], [-73.990927, 40.777567], [-73.990396, 40.777585], [-73.989461, 40.778875], [-73.989176, 40.779288], [-73.988869, 40.779693], [-73.988872, 40.779714], [-73.989219, 40.779698], [-73.989278, 40.779723], [-73.989409, 40.779738], [-73.989499, 40.779725], [-73.989596, 40.779698], [-73.989680, 40.779678], [-73.989753, 40.779671], [-73.989842, 40.779681], [-73.990040, 40.779708], [-73.990138, 40.779700], [-73.990336, 40.779662], [-73.990431, 40.779665], [-73.990622, 40.779676], [-73.990745, 40.779671], [-73.990872, 40.779646], [-73.990962, 40.779640], [-73.991057, 40.779652], [-73.991157, 40.779670], [-73.991243, 40.779671], [-73.991255, 40.779651], [-73.991295, 40.779630], [-73.991322, 40.779632], [-73.991359, 40.779586], [-73.991551, 40.779575], [-73.991420, 40.779755], [-73.988886, 40.779879], [-73.988940, 40.779956], [-73.988926, 40.780059], [-73.988912, 40.780096], [-73.988919, 40.780226], [-73.988381, 40.780981], [-73.988232, 40.781233], [-73.988210, 40.781225], [-73.988140, 40.781409], [-73.988041, 40.781586], [-73.988100, 40.781603], [-73.988076, 40.781651], [-73.988018, 40.781634], [-73.987961, 40.781771], [-73.985466, 40.785361], [-73.986173, 40.786068], [-73.986456, 40.785919], [-73.987072, 40.785190], [-73.987119, 40.785210], [-73.986498, 40.785951], [-73.986165, 40.786122], [-73.986128, 40.786239], [-73.986071, 40.786241], [-73.986027, 40.786229], [-73.986098, 40.786058], [-73.985429, 40.785414], [-73.985081, 40.785922], [-73.985199, 40.785967], [-73.985171, 40.786013], [-73.985216, 40.786031], [-73.985255, 40.785976], [-73.985243, 40.785973], [-73.985250, 40.785963], [-73.985282, 40.785979], [-73.985240, 40.786036], [-73.985684, 40.786222], [-73.985718, 40.786176], [-73.985766, 40.786196], [-73.985683, 40.786310], [-73.985636, 40.786290], [-73.985671, 40.786243], [-73.985205, 40.786048], [-73.985211, 40.786040], [-73.985163, 40.786021], [-73.985132, 40.786060], [-73.985017, 40.786014], [-73.984655, 40.786535], [-73.985744, 40.786570], [-73.985892, 40.786427], [-73.985943, 40.786453], [-73.985950, 40.786487], [-73.985812, 40.786617], [-73.985135, 40.786588], [-73.984619, 40.786586], [-73.981952, 40.790394], [-73.972823, 40.803428], [-73.971037, 40.805918], [-73.966701, 40.804169], [-73.959647, 40.801156], [-73.958509, 40.800682], [-73.958533, 40.800491], [-73.958358, 40.800369]],
    color: '#8b5cf6',
  },
  'Lower East Side': {
    center: [-73.984232, 40.712291],
    coordinates: [[-73.974893, 40.715152], [-73.976050, 40.712604], [-73.976712, 40.711536], [-73.977057, 40.711198], [-73.977377, 40.710954], [-73.977527, 40.710843], [-73.977721, 40.710710], [-73.977821, 40.710645], [-73.977997, 40.710561], [-73.978182, 40.710507], [-73.979373, 40.710417], [-73.980283, 40.710362], [-73.980299, 40.710343], [-73.980314, 40.710333], [-73.980331, 40.710324], [-73.980330, 40.710287], [-73.981180, 40.710227], [-73.981277, 40.710217], [-73.981237, 40.709823], [-73.981333, 40.709814], [-73.988165, 40.709157], [-73.988173, 40.709148], [-73.988390, 40.709127], [-73.988391, 40.709127], [-73.988447, 40.709134], [-73.988480, 40.709156], [-73.988497, 40.709176], [-73.988637, 40.709912], [-73.988645, 40.709917], [-73.988670, 40.709920], [-73.988696, 40.709928], [-73.988718, 40.709947], [-73.988737, 40.709971], [-73.988797, 40.709967], [-73.989358, 40.709901], [-73.990158, 40.709790], [-73.990789, 40.709690], [-73.991898, 40.709541], [-73.992457, 40.711754], [-73.992623, 40.713168], [-73.990120, 40.713382], [-73.990200, 40.714665], [-73.989155, 40.716708], [-73.994808, 40.718457], [-73.994378, 40.719519], [-73.994393, 40.719525], [-73.992604, 40.724136], [-73.978753, 40.719934], [-73.977224, 40.719310], [-73.975452, 40.718947], [-73.974739, 40.718801], [-73.973576, 40.718589], [-73.974893, 40.715152]],
    color: '#a855f7',
  },
  'Financial District': {
    center: [-74.008324, 40.702680],
    coordinates: [[-74.013754, 40.713690], [-74.008614, 40.711372], [-74.005769, 40.712007], [-74.005360, 40.712151], [-74.003662, 40.711487], [-74.003355, 40.711230], [-74.003337, 40.711236], [-73.999102, 40.707968], [-73.999523, 40.707763], [-73.999491, 40.707722], [-73.999538, 40.707693], [-73.999551, 40.707694], [-73.999609, 40.707760], [-73.999949, 40.707591], [-73.999945, 40.707583], [-73.999949, 40.707559], [-73.999957, 40.707531], [-73.999972, 40.707506], [-74.000234, 40.707347], [-74.001187, 40.706860], [-74.001131, 40.706799], [-74.001232, 40.706740], [-74.001160, 40.706664], [-74.001175, 40.706649], [-74.001169, 40.706639], [-74.001176, 40.706635], [-74.001176, 40.706628], [-74.000983, 40.706417], [-74.001407, 40.706179], [-74.000731, 40.705568], [-74.000583, 40.705434], [-74.000592, 40.705410], [-74.001437, 40.704872], [-74.001461, 40.704874], [-74.001835, 40.705212], [-74.002061, 40.705417], [-74.002158, 40.705357], [-74.002570, 40.705524], [-74.002685, 40.705449], [-74.002363, 40.705159], [-74.002416, 40.705129], [-74.001971, 40.704738], [-74.001970, 40.704731], [-74.002172, 40.704607], [-74.002186, 40.704607], [-74.002333, 40.704748], [-74.002334, 40.704743], [-74.002421, 40.704680], [-74.002431, 40.704678], [-74.002488, 40.704727], [-74.002488, 40.704734], [-74.002398, 40.704795], [-74.002387, 40.704796], [-74.003323, 40.705629], [-74.003632, 40.705430], [-74.003608, 40.705408], [-74.003559, 40.705438], [-74.002878, 40.704831], [-74.002972, 40.704766], [-74.003584, 40.705302], [-74.003650, 40.705378], [-74.003622, 40.705399], [-74.003644, 40.705422], [-74.003833, 40.705303], [-74.003948, 40.705403], [-74.004383, 40.705113], [-74.004267, 40.705012], [-74.004590, 40.704788], [-74.003496, 40.703797], [-74.003720, 40.703654], [-74.003985, 40.703896], [-74.004806, 40.704642], [-74.004841, 40.704640], [-74.005188, 40.704421], [-74.005111, 40.704351], [-74.005085, 40.704366], [-74.004926, 40.704212], [-74.005004, 40.704165], [-74.005163, 40.704320], [-74.005139, 40.704335], [-74.005212, 40.704406], [-74.005350, 40.704310], [-74.004181, 40.703250], [-74.004157, 40.703232], [-74.004207, 40.703199], [-74.004118, 40.703112], [-74.004273, 40.703016], [-74.004298, 40.703017], [-74.004326, 40.703045], [-74.004347, 40.703047], [-74.004677, 40.703348], [-74.004802, 40.703484], [-74.004988, 40.703637], [-74.005208, 40.703821], [-74.005396, 40.703942], [-74.005663, 40.704104], [-74.006019, 40.703873], [-74.006140, 40.703979], [-74.006596, 40.703686], [-74.006324, 40.703470], [-74.005484, 40.702714], [-74.005527, 40.702685], [-74.005505, 40.702667], [-74.005471, 40.702690], [-74.005436, 40.702660], [-74.005427, 40.702665], [-74.005304, 40.702560], [-74.005494, 40.702431], [-74.005502, 40.702431], [-74.005614, 40.702530], [-74.005609, 40.702553], [-74.005599, 40.702580], [-74.005592, 40.702599], [-74.005589, 40.702613], [-74.005535, 40.702646], [-74.005558, 40.702664], [-74.005675, 40.702584], [-74.006239, 40.703080], [-74.006494, 40.703301], [-74.006785, 40.703568], [-74.007527, 40.703115], [-74.007659, 40.702909], [-74.007705, 40.702882], [-74.007707, 40.702875], [-74.009128, 40.702008], [-74.009309, 40.701955], [-74.009085, 40.701655], [-74.008700, 40.701140], [-74.007755, 40.701548], [-74.007591, 40.701328], [-74.008536, 40.700920], [-74.008349, 40.700669], [-74.008620, 40.700552], [-74.009342, 40.701520], [-74.009601, 40.701865], [-74.010511, 40.701640], [-74.011167, 40.701477], [-74.011096, 40.701275], [-74.011290, 40.701250], [-74.011210, 40.701045], [-74.011129, 40.701065], [-74.011078, 40.700957], [-74.011067, 40.700915], [-74.011109, 40.700901], [-74.011094, 40.700866], [-74.011093, 40.700851], [-74.011079, 40.700852], [-74.011056, 40.700812], [-74.011059, 40.700803], [-74.011037, 40.700757], [-74.011015, 40.700741], [-74.011029, 40.700731], [-74.011020, 40.700712], [-74.011007, 40.700711], [-74.010993, 40.700691], [-74.011009, 40.700684], [-74.011004, 40.700668], [-74.010991, 40.700673], [-74.010970, 40.700646], [-74.010988, 40.700634], [-74.010958, 40.700575], [-74.010936, 40.700576], [-74.010925, 40.700567], [-74.010926, 40.700556], [-74.010947, 40.700538], [-74.010919, 40.700486], [-74.010905, 40.700492], [-74.010885, 40.700461], [-74.010904, 40.700451], [-74.010785, 40.700233], [-74.010815, 40.700200], [-74.010852, 40.700239], [-74.011150, 40.700898], [-74.011358, 40.700852], [-74.011303, 40.700648], [-74.011298, 40.700599], [-74.011310, 40.700580], [-74.011334, 40.700568], [-74.011361, 40.700566], [-74.011382, 40.700570], [-74.011395, 40.700591], [-74.011503, 40.700815], [-74.011729, 40.700770], [-74.011683, 40.700693], [-74.011665, 40.700638], [-74.011631, 40.700555], [-74.011610, 40.700493], [-74.011614, 40.700473], [-74.011631, 40.700458], [-74.011678, 40.700462], [-74.011703, 40.700481], [-74.011726, 40.700479], [-74.011751, 40.700531], [-74.011777, 40.700571], [-74.011826, 40.700666], [-74.011854, 40.700739], [-74.012087, 40.700681], [-74.012069, 40.700600], [-74.011977, 40.700378], [-74.011905, 40.700227], [-74.011857, 40.700107], [-74.011931, 40.700051], [-74.011962, 40.700038], [-74.012040, 40.700048], [-74.012088, 40.700087], [-74.012128, 40.700143], [-74.012158, 40.700211], [-74.012237, 40.700321], [-74.012255, 40.700365], [-74.012392, 40.700621], [-74.012594, 40.700571], [-74.012591, 40.700512], [-74.012555, 40.700360], [-74.012529, 40.700252], [-74.012516, 40.700185], [-74.012515, 40.700150], [-74.012542, 40.700135], [-74.012614, 40.700108], [-74.012648, 40.700115], [-74.012681, 40.700147], [-74.012735, 40.700219], [-74.012796, 40.700300], [-74.012835, 40.700353], [-74.012866, 40.700408], [-74.012905, 40.700497], [-74.012909, 40.700524], [-74.013107, 40.700507], [-74.013112, 40.700360], [-74.013078, 40.700103], [-74.013034, 40.699924], [-74.013025, 40.699883], [-74.013012, 40.699818], [-74.013021, 40.699793], [-74.013044, 40.699775], [-74.013113, 40.699774], [-74.013141, 40.699803], [-74.013154, 40.699845], [-74.013167, 40.699931], [-74.013201, 40.700240], [-74.013273, 40.700497], [-74.013486, 40.700478], [-74.013481, 40.700358], [-74.013483, 40.700263], [-74.013503, 40.700176], [-74.013533, 40.700108], [-74.013587, 40.700080], [-74.013610, 40.700084], [-74.013675, 40.700126], [-74.013643, 40.700162], [-74.013612, 40.700245], [-74.013570, 40.700232], [-74.013561, 40.700295], [-74.013533, 40.700297], [-74.013530, 40.700311], [-74.013561, 40.700310], [-74.013560, 40.700367], [-74.013530, 40.700374], [-74.013531, 40.700382], [-74.013563, 40.700380], [-74.013560, 40.700439], [-74.013524, 40.700442], [-74.013523, 40.700460], [-74.013581, 40.700457], [-74.013585, 40.700502], [-74.013553, 40.700503], [-74.013577, 40.700644], [-74.013510, 40.700650], [-74.013558, 40.700940], [-74.013952, 40.700991], [-74.013959, 40.700966], [-74.014008, 40.701043], [-74.015127, 40.701390], [-74.015630, 40.701862], [-74.016174, 40.702572], [-74.016542, 40.704733], [-74.014262, 40.710928], [-74.013754, 40.713690]],
    color: '#d946ef',
  },
  'Williamsburg': {
    center: [-73.953036, 40.715285],
    coordinates: [[-73.957572, 40.725097], [-73.952998, 40.722253], [-73.955348, 40.720049], [-73.952803, 40.718462], [-73.952402, 40.718797], [-73.947516, 40.719267], [-73.944926, 40.720774], [-73.943899, 40.719604], [-73.942678, 40.720277], [-73.940796, 40.720457], [-73.940624, 40.719435], [-73.936209, 40.720576], [-73.934704, 40.717209], [-73.924631, 40.719855], [-73.924520, 40.719613], [-73.924579, 40.719163], [-73.924702, 40.718688], [-73.924992, 40.718385], [-73.927148, 40.717871], [-73.928379, 40.717578], [-73.928880, 40.717720], [-73.929705, 40.717049], [-73.929320, 40.716112], [-73.929472, 40.715725], [-73.929474, 40.715721], [-73.932198, 40.714972], [-73.932141, 40.714681], [-73.931754, 40.714742], [-73.931241, 40.713725], [-73.931645, 40.713343], [-73.932639, 40.713053], [-73.932033, 40.711590], [-73.933385, 40.711234], [-73.933283, 40.710979], [-73.931901, 40.711338], [-73.930932, 40.709165], [-73.930501, 40.708681], [-73.930361, 40.708718], [-73.930250, 40.708928], [-73.931546, 40.711855], [-73.930779, 40.712160], [-73.931610, 40.712038], [-73.931849, 40.712565], [-73.931734, 40.712749], [-73.930423, 40.713173], [-73.931052, 40.714610], [-73.930852, 40.714903], [-73.928439, 40.715531], [-73.928619, 40.715949], [-73.928906, 40.716619], [-73.928233, 40.717106], [-73.927003, 40.717397], [-73.924645, 40.717953], [-73.923640, 40.717321], [-73.923607, 40.717266], [-73.923295, 40.716744], [-73.923286, 40.716728], [-73.923055, 40.716343], [-73.923983, 40.715977], [-73.924313, 40.715847], [-73.924886, 40.715267], [-73.924336, 40.714123], [-73.924059, 40.714112], [-73.923928, 40.714102], [-73.923920, 40.714074], [-73.922116, 40.712928], [-73.921792, 40.712080], [-73.921660, 40.711734], [-73.921348, 40.710916], [-73.921326, 40.710859], [-73.920779, 40.710496], [-73.920730, 40.710461], [-73.921676, 40.709471], [-73.925980, 40.705792], [-73.933951, 40.702674], [-73.940420, 40.701077], [-73.941149, 40.700281], [-73.941931, 40.700725], [-73.957020, 40.698974], [-73.961899, 40.698188], [-73.962067, 40.698869], [-73.961705, 40.699925], [-73.967210, 40.704256], [-73.967477, 40.703950], [-73.969297, 40.705088], [-73.969293, 40.706935], [-73.969293, 40.707093], [-73.969573, 40.707552], [-73.969849, 40.708003], [-73.969941, 40.709310], [-73.969557, 40.710296], [-73.969647, 40.710375], [-73.969945, 40.710400], [-73.970010, 40.710454], [-73.969971, 40.710508], [-73.969731, 40.710513], [-73.969634, 40.710665], [-73.969712, 40.710690], [-73.969794, 40.710741], [-73.969750, 40.710833], [-73.969685, 40.710854], [-73.969349, 40.710961], [-73.969362, 40.711000], [-73.969582, 40.711108], [-73.969694, 40.711137], [-73.969763, 40.711173], [-73.969704, 40.711237], [-73.969562, 40.711197], [-73.969336, 40.711113], [-73.969258, 40.711162], [-73.969239, 40.711246], [-73.969452, 40.711394], [-73.969426, 40.711473], [-73.969303, 40.711512], [-73.969187, 40.711468], [-73.969115, 40.711512], [-73.968867, 40.712232], [-73.968809, 40.712256], [-73.968869, 40.712266], [-73.968831, 40.712393], [-73.968945, 40.712427], [-73.968796, 40.712737], [-73.968729, 40.712720], [-73.968680, 40.712849], [-73.968499, 40.712804], [-73.968470, 40.712825], [-73.968473, 40.712853], [-73.968452, 40.712923], [-73.968568, 40.712949], [-73.968499, 40.713103], [-73.968842, 40.713224], [-73.968391, 40.714262], [-73.968008, 40.715121], [-73.967654, 40.715869], [-73.967364, 40.716484], [-73.967292, 40.716516], [-73.967244, 40.716585], [-73.967263, 40.716666], [-73.967114, 40.716898], [-73.967215, 40.716956], [-73.967268, 40.716986], [-73.966597, 40.717968], [-73.967183, 40.718276], [-73.967193, 40.718265], [-73.967307, 40.718313], [-73.967182, 40.718483], [-73.967069, 40.718439], [-73.967151, 40.718316], [-73.966562, 40.718016], [-73.966554, 40.718037], [-73.966531, 40.718032], [-73.966353, 40.718304], [-73.966242, 40.718252], [-73.966076, 40.718397], [-73.966133, 40.718444], [-73.966147, 40.718502], [-73.965879, 40.718755], [-73.966343, 40.719019], [-73.966371, 40.718990], [-73.966630, 40.719132], [-73.966543, 40.719223], [-73.966319, 40.719108], [-73.966365, 40.719056], [-73.965858, 40.718773], [-73.965703, 40.718918], [-73.965634, 40.718934], [-73.965526, 40.718901], [-73.965154, 40.719270], [-73.965284, 40.719361], [-73.965396, 40.719565], [-73.965547, 40.719659], [-73.965385, 40.719954], [-73.965374, 40.720094], [-73.965137, 40.720344], [-73.965013, 40.720290], [-73.964905, 40.720327], [-73.964464, 40.720065], [-73.964356, 40.720163], [-73.964480, 40.720233], [-73.964398, 40.720297], [-73.964683, 40.720470], [-73.964593, 40.720545], [-73.964351, 40.720404], [-73.964088, 40.720756], [-73.965049, 40.721357], [-73.964894, 40.721475], [-73.963998, 40.720938], [-73.963539, 40.721573], [-73.963438, 40.721559], [-73.962966, 40.722034], [-73.962872, 40.722215], [-73.962253, 40.723532], [-73.962073, 40.723880], [-73.962468, 40.724132], [-73.962472, 40.724175], [-73.962443, 40.724200], [-73.962390, 40.724194], [-73.962366, 40.724209], [-73.962007, 40.723992], [-73.961894, 40.724107], [-73.961660, 40.724860], [-73.961611, 40.724951], [-73.958749, 40.723085], [-73.957720, 40.724271], [-73.957572, 40.725097]],
    color: '#ec4899',
  },
  'DUMBO': {
    center: [-73.991320, 40.704011],
    coordinates: [[-73.986623, 40.704979], [-73.986530, 40.704979], [-73.986429, 40.705069], [-73.986434, 40.705349], [-73.984535, 40.705520], [-73.984583, 40.704344], [-73.984760, 40.701446], [-73.986748, 40.701526], [-73.986784, 40.701120], [-73.989986, 40.701612], [-73.990474, 40.701690], [-73.991296, 40.701644], [-73.991987, 40.701607], [-73.992588, 40.702125], [-73.993258, 40.702461], [-73.994358, 40.702910], [-73.995046, 40.703132], [-73.995446, 40.703275], [-73.995293, 40.703554], [-73.994800, 40.703292], [-73.994663, 40.703431], [-73.994995, 40.703651], [-73.994882, 40.703788], [-73.994910, 40.703797], [-73.994930, 40.703771], [-73.995029, 40.703808], [-73.994882, 40.704009], [-73.994769, 40.703953], [-73.994714, 40.703997], [-73.994792, 40.704068], [-73.994792, 40.704089], [-73.994698, 40.704165], [-73.994776, 40.704246], [-73.994570, 40.704376], [-73.993863, 40.704556], [-73.993807, 40.704540], [-73.993775, 40.704449], [-73.993586, 40.704509], [-73.993626, 40.704595], [-73.993509, 40.704624], [-73.992801, 40.704634], [-73.992691, 40.704630], [-73.992512, 40.704694], [-73.992127, 40.704690], [-73.992121, 40.704396], [-73.991862, 40.704087], [-73.991418, 40.704004], [-73.990948, 40.704032], [-73.990715, 40.704351], [-73.990546, 40.704416], [-73.990308, 40.704840], [-73.990285, 40.704866], [-73.990227, 40.704934], [-73.990091, 40.704943], [-73.988303, 40.704540], [-73.988295, 40.704888], [-73.988290, 40.705071], [-73.987957, 40.705134], [-73.987270, 40.705176], [-73.986863, 40.705160], [-73.986730, 40.705106], [-73.986664, 40.705049], [-73.986623, 40.704979]],
    color: '#f43f5e',
  },
  'Brooklyn Heights': {
    center: [-73.997729, 40.697760],
    coordinates: [[-73.998871, 40.697158], [-74.001049, 40.697908], [-74.000488, 40.698758], [-73.998378, 40.698063], [-73.998021, 40.698762], [-74.000018, 40.699466], [-73.999475, 40.700323], [-73.997499, 40.699639], [-73.997367, 40.699634], [-73.997161, 40.699793], [-73.997181, 40.699994], [-73.997176, 40.700106], [-73.997245, 40.700141], [-73.996698, 40.700877], [-73.996822, 40.700991], [-73.997528, 40.701229], [-73.997760, 40.701359], [-73.997802, 40.701319], [-73.998139, 40.701519], [-73.996192, 40.703377], [-73.995138, 40.702974], [-73.995046, 40.703132], [-73.994358, 40.702910], [-73.993258, 40.702461], [-73.992588, 40.702125], [-73.991987, 40.701607], [-73.990930, 40.700767], [-73.991031, 40.699845], [-73.991409, 40.698632], [-73.991365, 40.697010], [-73.990447, 40.693735], [-73.991742, 40.690993], [-73.992012, 40.690432], [-73.992368, 40.689691], [-73.999254, 40.691576], [-74.001744, 40.692407], [-74.004008, 40.693208], [-74.003462, 40.694057], [-74.001270, 40.693296], [-74.000959, 40.694069], [-74.003014, 40.694778], [-74.002398, 40.695712], [-74.000269, 40.694966], [-73.999413, 40.696358], [-73.999524, 40.696575], [-74.000489, 40.696926], [-74.000431, 40.697052], [-73.999593, 40.696782], [-73.999531, 40.696877], [-73.999588, 40.696898], [-73.999554, 40.696945], [-73.999407, 40.696885], [-73.999503, 40.696727], [-73.999474, 40.696704], [-73.999295, 40.696795], [-73.999182, 40.696885], [-73.998996, 40.696812], [-73.998940, 40.696941], [-73.998872, 40.696924], [-73.998855, 40.696954], [-73.998765, 40.697121], [-73.998871, 40.697158]],
    color: '#fb7185',
  },
  'Park Slope': {
    center: [-73.975059, 40.675940],
    coordinates: [[-73.977431, 40.684043], [-73.971050, 40.675237], [-73.971294, 40.674891], [-73.971448, 40.674515], [-73.971533, 40.674132], [-73.971479, 40.673738], [-73.971261, 40.673214], [-73.970923, 40.672787], [-73.970702, 40.672667], [-73.970437, 40.672621], [-73.970475, 40.672351], [-73.976860, 40.664614], [-73.988726, 40.670342], [-73.983900, 40.676148], [-73.980051, 40.681860], [-73.978033, 40.684853], [-73.978026, 40.684864], [-73.977431, 40.684043]],
    color: '#fb923c',
  },
  'Greenpoint': {
    center: [-73.949893, 40.731560],
    coordinates: [[-73.962263, 40.732916], [-73.962360, 40.732913], [-73.963326, 40.732831], [-73.963337, 40.732839], [-73.963521, 40.732827], [-73.963531, 40.732850], [-73.963557, 40.732849], [-73.963566, 40.732894], [-73.963575, 40.732895], [-73.963578, 40.732912], [-73.963589, 40.732912], [-73.963587, 40.732922], [-73.963677, 40.732920], [-73.963661, 40.732799], [-73.964031, 40.732758], [-73.964049, 40.732762], [-73.964065, 40.732779], [-73.964088, 40.732919], [-73.964079, 40.732933], [-73.964060, 40.732945], [-73.963652, 40.732987], [-73.963653, 40.732992], [-73.963577, 40.732998], [-73.963574, 40.732995], [-73.963539, 40.732997], [-73.963537, 40.733000], [-73.962357, 40.733110], [-73.962304, 40.733114], [-73.962341, 40.733389], [-73.962308, 40.733532], [-73.962355, 40.733713], [-73.962325, 40.733908], [-73.962285, 40.734048], [-73.962090, 40.734508], [-73.961910, 40.734751], [-73.961575, 40.735180], [-73.961351, 40.735421], [-73.960519, 40.736342], [-73.959829, 40.737061], [-73.959306, 40.737452], [-73.958501, 40.738007], [-73.958375, 40.738097], [-73.957765, 40.738464], [-73.956930, 40.738887], [-73.955640, 40.739044], [-73.954663, 40.739128], [-73.954396, 40.739115], [-73.953233, 40.738993], [-73.951988, 40.738748], [-73.950387, 40.738285], [-73.948844, 40.737686], [-73.948123, 40.737397], [-73.948092, 40.737468], [-73.947162, 40.737155], [-73.946524, 40.736927], [-73.946454, 40.736810], [-73.946724, 40.736264], [-73.946901, 40.735901], [-73.947200, 40.735355], [-73.947143, 40.734956], [-73.947065, 40.734402], [-73.946598, 40.734442], [-73.946655, 40.734792], [-73.946737, 40.735295], [-73.946757, 40.735258], [-73.946929, 40.735313], [-73.946627, 40.735866], [-73.946443, 40.735813], [-73.946247, 40.736166], [-73.946172, 40.736203], [-73.945873, 40.736102], [-73.945570, 40.736612], [-73.945533, 40.736605], [-73.945520, 40.736591], [-73.945545, 40.736538], [-73.945416, 40.736502], [-73.945400, 40.736538], [-73.945359, 40.736550], [-73.945207, 40.736509], [-73.945201, 40.736487], [-73.945220, 40.736444], [-73.945078, 40.736393], [-73.945059, 40.736439], [-73.945034, 40.736449], [-73.944999, 40.736437], [-73.944999, 40.736417], [-73.945255, 40.735893], [-73.945185, 40.735479], [-73.945033, 40.735429], [-73.945006, 40.735531], [-73.944961, 40.735634], [-73.944923, 40.735703], [-73.944773, 40.735986], [-73.944740, 40.736024], [-73.944550, 40.736225], [-73.944539, 40.736229], [-73.944517, 40.736235], [-73.944523, 40.736245], [-73.944537, 40.736251], [-73.944543, 40.736255], [-73.944544, 40.736264], [-73.944533, 40.736277], [-73.944515, 40.736284], [-73.944492, 40.736283], [-73.944448, 40.736275], [-73.944380, 40.736252], [-73.944146, 40.736157], [-73.943956, 40.736082], [-73.943807, 40.736023], [-73.943742, 40.735998], [-73.943213, 40.735791], [-73.942394, 40.735426], [-73.942086, 40.735203], [-73.941738, 40.734951], [-73.941792, 40.734913], [-73.941607, 40.734688], [-73.941546, 40.734734], [-73.941147, 40.734153], [-73.940997, 40.733790], [-73.941156, 40.733749], [-73.941038, 40.733488], [-73.940929, 40.733511], [-73.940818, 40.733249], [-73.940726, 40.733291], [-73.940569, 40.733058], [-73.940685, 40.733017], [-73.940367, 40.732213], [-73.939813, 40.731153], [-73.938103, 40.729729], [-73.938089, 40.729747], [-73.936931, 40.729108], [-73.936328, 40.728952], [-73.934929, 40.728544], [-73.932347, 40.728192], [-73.932004, 40.728145], [-73.930326, 40.727795], [-73.929663, 40.727543], [-73.929632, 40.727565], [-73.929624, 40.727578], [-73.929627, 40.727600], [-73.929612, 40.727611], [-73.929580, 40.727613], [-73.929243, 40.727398], [-73.929269, 40.727365], [-73.928870, 40.727003], [-73.928494, 40.726615], [-73.928131, 40.726173], [-73.927939, 40.725884], [-73.927872, 40.725854], [-73.927834, 40.725422], [-73.927797, 40.724926], [-73.926543, 40.722160], [-73.925615, 40.720062], [-73.924818, 40.720265], [-73.924631, 40.719855], [-73.934704, 40.717209], [-73.936209, 40.720576], [-73.940624, 40.719435], [-73.940796, 40.720457], [-73.942678, 40.720277], [-73.943899, 40.719604], [-73.944926, 40.720774], [-73.947516, 40.719267], [-73.952402, 40.718797], [-73.952803, 40.718462], [-73.955348, 40.720049], [-73.952998, 40.722253], [-73.957572, 40.725097], [-73.957720, 40.724271], [-73.958749, 40.723085], [-73.961611, 40.724951], [-73.961660, 40.724860], [-73.962115, 40.725148], [-73.961902, 40.725321], [-73.961605, 40.725148], [-73.961537, 40.725109], [-73.961413, 40.725177], [-73.961164, 40.725265], [-73.960432, 40.725114], [-73.960367, 40.725047], [-73.958331, 40.724412], [-73.958039, 40.724427], [-73.957942, 40.724649], [-73.957951, 40.725036], [-73.958352, 40.725198], [-73.958426, 40.725401], [-73.960125, 40.725320], [-73.960285, 40.725948], [-73.961063, 40.725845], [-73.961615, 40.725866], [-73.961653, 40.726204], [-73.961617, 40.726661], [-73.961499, 40.726751], [-73.961418, 40.727356], [-73.961328, 40.727644], [-73.960996, 40.728769], [-73.961061, 40.728777], [-73.961071, 40.729220], [-73.961140, 40.729416], [-73.961195, 40.729416], [-73.961349, 40.730162], [-73.961284, 40.730162], [-73.961432, 40.730965], [-73.961716, 40.731570], [-73.961826, 40.731608], [-73.961909, 40.731651], [-73.962263, 40.732916]],
    color: '#fbbf24',
  },
  'Greenwich Village': {
    center: [-73.995368, 40.731158],
    coordinates: [[-73.991460, 40.731738], [-73.992854, 40.730083], [-73.996772, 40.725432], [-73.997635, 40.725786], [-74.002856, 40.728347], [-74.001413, 40.731065], [-73.996797, 40.737364], [-73.991725, 40.735245], [-73.990704, 40.734782], [-73.991460, 40.731738]],
    color: '#10b981',
  },
  "Hell's Kitchen": {
    center: [-73.999821, 40.765666],
    coordinates: [[-73.990724, 40.755950], [-73.990726, 40.755951], [-73.993464, 40.752190], [-74.004927, 40.757023], [-74.005567, 40.757118], [-74.005419, 40.757323], [-74.005212, 40.757232], [-74.004804, 40.757810], [-74.005279, 40.758029], [-74.005235, 40.758087], [-74.005031, 40.758357], [-74.006964, 40.759160], [-74.006994, 40.759176], [-74.007010, 40.759204], [-74.007004, 40.759232], [-74.006530, 40.759875], [-74.006507, 40.759892], [-74.006476, 40.759894], [-74.006444, 40.759890], [-74.006315, 40.759843], [-74.004505, 40.759085], [-74.004307, 40.759361], [-74.004206, 40.759502], [-74.003907, 40.759376], [-74.003807, 40.759511], [-74.004155, 40.759660], [-74.004247, 40.759699], [-74.004165, 40.759813], [-74.004149, 40.759836], [-74.004245, 40.759887], [-74.004260, 40.759875], [-74.004319, 40.759911], [-74.004269, 40.759959], [-74.004211, 40.759925], [-74.004223, 40.759913], [-74.004132, 40.759862], [-74.004112, 40.759893], [-74.003669, 40.759706], [-74.003573, 40.759846], [-74.003573, 40.759847], [-74.003687, 40.759897], [-74.003929, 40.760003], [-74.003927, 40.760005], [-74.003882, 40.760066], [-74.003171, 40.761027], [-74.003133, 40.761078], [-74.002787, 40.760929], [-74.002669, 40.761090], [-74.002335, 40.761544], [-74.004545, 40.762493], [-74.004558, 40.762508], [-74.004556, 40.762524], [-74.004450, 40.762665], [-74.004427, 40.762676], [-74.004400, 40.762671], [-74.002201, 40.761728], [-74.001533, 40.762645], [-74.003757, 40.763582], [-74.003612, 40.763777], [-74.003340, 40.763664], [-74.001386, 40.762850], [-74.000973, 40.763420], [-74.003150, 40.764333], [-74.002948, 40.764617], [-74.003062, 40.764666], [-74.003135, 40.764650], [-74.003162, 40.764613], [-74.003223, 40.764638], [-74.003156, 40.764731], [-74.003147, 40.764736], [-74.003136, 40.764741], [-74.003125, 40.764744], [-74.003113, 40.764746], [-74.003101, 40.764746], [-74.003089, 40.764744], [-73.999927, 40.763407], [-73.999639, 40.763569], [-73.999623, 40.763559], [-73.999151, 40.764205], [-73.999314, 40.764272], [-73.999520, 40.763974], [-74.001411, 40.764772], [-74.001498, 40.764675], [-74.001939, 40.764867], [-74.001860, 40.764962], [-74.002457, 40.765214], [-74.002221, 40.765501], [-74.002274, 40.765525], [-74.002288, 40.765562], [-74.002057, 40.765877], [-74.002025, 40.765893], [-73.998885, 40.764569], [-73.998576, 40.764999], [-73.998600, 40.765073], [-73.998635, 40.765086], [-73.998665, 40.765104], [-73.998686, 40.765137], [-73.998696, 40.765175], [-73.998689, 40.765209], [-73.998668, 40.765237], [-73.998634, 40.765260], [-73.998589, 40.765276], [-73.998483, 40.765298], [-73.998438, 40.765316], [-73.998402, 40.765351], [-73.998291, 40.765521], [-73.998271, 40.765552], [-73.998282, 40.765568], [-74.001542, 40.766945], [-74.001573, 40.766977], [-74.001562, 40.766996], [-74.001394, 40.767230], [-74.001364, 40.767249], [-74.001315, 40.767251], [-73.998157, 40.765894], [-73.998148, 40.765906], [-73.998067, 40.765872], [-73.997382, 40.766818], [-73.997378, 40.766823], [-74.000628, 40.768203], [-74.000650, 40.768220], [-74.000650, 40.768245], [-74.000455, 40.768504], [-74.000418, 40.768512], [-74.000386, 40.768504], [-73.997156, 40.767129], [-73.996457, 40.768099], [-73.999728, 40.769474], [-73.999736, 40.769506], [-73.999555, 40.769751], [-73.999516, 40.769768], [-73.999473, 40.769764], [-73.997072, 40.768733], [-73.997026, 40.768796], [-73.997150, 40.768847], [-73.997145, 40.768853], [-73.997011, 40.769029], [-73.996893, 40.768980], [-73.996571, 40.769425], [-73.999027, 40.770463], [-73.998762, 40.770825], [-73.996313, 40.769799], [-73.995880, 40.770401], [-73.996017, 40.770455], [-73.995901, 40.770613], [-73.995767, 40.770555], [-73.995425, 40.771032], [-73.995756, 40.771161], [-73.995709, 40.771226], [-73.995798, 40.771283], [-73.995817, 40.771257], [-73.995913, 40.771298], [-73.995928, 40.771275], [-73.996002, 40.771307], [-73.995900, 40.771450], [-73.995893, 40.771447], [-73.995854, 40.771499], [-73.995791, 40.771476], [-73.995828, 40.771422], [-73.995730, 40.771379], [-73.995751, 40.771354], [-73.995630, 40.771325], [-73.995623, 40.771337], [-73.995306, 40.771196], [-73.995124, 40.771451], [-73.994990, 40.771441], [-73.994957, 40.771449], [-73.994935, 40.771468], [-73.994924, 40.771486], [-73.994926, 40.771516], [-73.995009, 40.771607], [-73.994978, 40.771645], [-73.994977, 40.771659], [-73.997112, 40.772553], [-73.996909, 40.772833], [-73.994774, 40.771930], [-73.994532, 40.772259], [-73.994445, 40.772377], [-73.995455, 40.772803], [-73.995545, 40.772675], [-73.996449, 40.773057], [-73.996356, 40.773179], [-73.996230, 40.773129], [-73.996143, 40.773248], [-73.996562, 40.773411], [-73.996685, 40.773504], [-73.996677, 40.773510], [-73.994342, 40.772525], [-73.994250, 40.772526], [-73.994163, 40.772487], [-73.994159, 40.772493], [-73.993650, 40.772146], [-73.982389, 40.767411], [-73.984726, 40.764167], [-73.990724, 40.755950]],
    color: '#0ea5e9',
  },
  'Murray Hill': {
    center: [-73.970873, 40.744892],
    coordinates: [[-73.967919, 40.747961], [-73.968174, 40.747667], [-73.968365, 40.747433], [-73.968232, 40.747368], [-73.968296, 40.747296], [-73.968302, 40.747273], [-73.968316, 40.747274], [-73.968326, 40.747252], [-73.968943, 40.746518], [-73.969624, 40.745747], [-73.969697, 40.745657], [-73.969876, 40.745445], [-73.969906, 40.745458], [-73.969912, 40.745452], [-73.969931, 40.745463], [-73.969927, 40.745468], [-73.969974, 40.745496], [-73.970048, 40.745403], [-73.970339, 40.745050], [-73.970326, 40.745037], [-73.970326, 40.745023], [-73.970378, 40.744952], [-73.970443, 40.744870], [-73.970461, 40.744865], [-73.970472, 40.744866], [-73.970788, 40.744406], [-73.970941, 40.744471], [-73.971125, 40.744190], [-73.971111, 40.744184], [-73.971092, 40.744182], [-73.971075, 40.744176], [-73.970905, 40.744103], [-73.970758, 40.744039], [-73.970751, 40.744030], [-73.970718, 40.744017], [-73.970706, 40.744003], [-73.970703, 40.743990], [-73.970743, 40.743948], [-73.970751, 40.743949], [-73.970761, 40.743942], [-73.970792, 40.743956], [-73.970799, 40.743953], [-73.971173, 40.744108], [-73.971358, 40.743838], [-73.971205, 40.743772], [-73.971281, 40.743652], [-73.971241, 40.743638], [-73.971208, 40.743699], [-73.971200, 40.743706], [-73.971188, 40.743707], [-73.971098, 40.743678], [-73.971085, 40.743664], [-73.971233, 40.743415], [-73.971246, 40.743402], [-73.971256, 40.743402], [-73.971267, 40.743390], [-73.971354, 40.743425], [-73.971350, 40.743432], [-73.971357, 40.743437], [-73.971361, 40.743444], [-73.971311, 40.743524], [-73.971356, 40.743540], [-73.971681, 40.743042], [-73.971682, 40.743041], [-73.979711, 40.746385], [-73.982955, 40.747744], [-73.979287, 40.752801], [-73.967919, 40.747961]],
    color: '#8b5cf6',
  },
  'NoHo': {
    center: [-73.993182, 40.726613],
    coordinates: [[-73.992604, 40.724136], [-73.995395, 40.725004], [-73.996772, 40.725432], [-73.992854, 40.730083], [-73.990757, 40.729741], [-73.991285, 40.727762], [-73.992604, 40.724136]],
    color: '#f59e0b',
  },
  'Nolita': {
    center: [-73.995207, 40.722768],
    coordinates: [[-73.992604, 40.724136], [-73.994393, 40.719525], [-73.997670, 40.720820], [-73.997124, 40.722290], [-73.996661, 40.723467], [-73.995395, 40.725004], [-73.992604, 40.724136]],
    color: '#84cc16',
  },
  'Chinatown': {
    center: [-73.998236, 40.716033],
    coordinates: [[-73.999991, 40.717977], [-73.998636, 40.717077], [-73.997791, 40.716793], [-73.996478, 40.719048], [-73.994808, 40.718457], [-73.989155, 40.716708], [-73.990200, 40.714665], [-73.990120, 40.713382], [-73.992623, 40.713168], [-73.997994, 40.712722], [-73.998174, 40.713328], [-73.998086, 40.713426], [-73.998535, 40.713446], [-74.000450, 40.714365], [-74.000528, 40.715170], [-74.000789, 40.715291], [-73.999940, 40.716553], [-74.000796, 40.716907], [-74.001554, 40.717305], [-74.002080, 40.716731], [-74.003523, 40.717444], [-74.003533, 40.717449], [-74.001886, 40.719395], [-73.999991, 40.717977]],
    color: '#dc2626',
  },
  'Little Italy': {
    center: [-73.996504, 40.718749],
    coordinates: [[-73.994393, 40.719525], [-73.994378, 40.719519], [-73.994808, 40.718457], [-73.996478, 40.719048], [-73.997791, 40.716793], [-73.998636, 40.717077], [-73.999991, 40.717977], [-73.997670, 40.720820], [-73.994393, 40.719525]],
    color: '#ea580c',
  },
  'Harlem': {
    center: [-73.953720, 40.819983],
    coordinates: [[-73.934568, 40.828149], [-73.934424, 40.827043], [-73.934346, 40.825777], [-73.934326, 40.825455], [-73.934129, 40.822262], [-73.934104, 40.821855], [-73.933972, 40.819730], [-73.933830, 40.819720], [-73.933830, 40.819521], [-73.934289, 40.819569], [-73.933992, 40.817786], [-73.942754, 40.805744], [-73.941166, 40.805063], [-73.942993, 40.802561], [-73.944597, 40.803228], [-73.949073, 40.797094], [-73.949228, 40.797149], [-73.949374, 40.797158], [-73.949657, 40.797069], [-73.957850, 40.800528], [-73.958074, 40.800359], [-73.958358, 40.800369], [-73.958533, 40.800491], [-73.958509, 40.800682], [-73.959647, 40.801156], [-73.959642, 40.801163], [-73.958249, 40.803107], [-73.958181, 40.805565], [-73.954288, 40.810992], [-73.961038, 40.818704], [-73.961790, 40.818025], [-73.962054, 40.818095], [-73.962029, 40.818123], [-73.961901, 40.818265], [-73.961055, 40.819208], [-73.960839, 40.819447], [-73.960543, 40.819777], [-73.960242, 40.820112], [-73.959999, 40.820383], [-73.959949, 40.820360], [-73.959815, 40.820298], [-73.959283, 40.820995], [-73.959131, 40.821169], [-73.959263, 40.821236], [-73.959303, 40.821190], [-73.959426, 40.821252], [-73.959147, 40.821571], [-73.959033, 40.821514], [-73.959235, 40.821278], [-73.959147, 40.821235], [-73.959090, 40.821206], [-73.958819, 40.821519], [-73.958887, 40.821547], [-73.958942, 40.821569], [-73.958745, 40.821806], [-73.958964, 40.822374], [-73.959000, 40.822410], [-73.959113, 40.822455], [-73.959230, 40.822287], [-73.959910, 40.822571], [-73.959603, 40.822995], [-73.958926, 40.822712], [-73.959050, 40.822541], [-73.958917, 40.822486], [-73.958867, 40.822450], [-73.958838, 40.822405], [-73.958646, 40.821904], [-73.958527, 40.821844], [-73.958200, 40.822283], [-73.958168, 40.822458], [-73.958075, 40.822611], [-73.957939, 40.822774], [-73.958228, 40.822888], [-73.958143, 40.823021], [-73.959483, 40.823579], [-73.959538, 40.823629], [-73.959556, 40.823694], [-73.959016, 40.824504], [-73.957259, 40.827117], [-73.956949, 40.827001], [-73.956318, 40.827944], [-73.955039, 40.827413], [-73.954706, 40.827906], [-73.954697, 40.827918], [-73.954545, 40.827863], [-73.954542, 40.827861], [-73.954526, 40.827884], [-73.952928, 40.830158], [-73.952345, 40.831020], [-73.951732, 40.831859], [-73.951316, 40.832451], [-73.951059, 40.832898], [-73.950936, 40.833294], [-73.950664, 40.833636], [-73.950423, 40.834047], [-73.950220, 40.834305], [-73.949342, 40.833982], [-73.948905, 40.834066], [-73.940346, 40.830458], [-73.934568, 40.828149]],
    color: '#7c3aed',
  },
  'Kips Bay': {
    center: [-73.973954, 40.736681],
    coordinates: [[-73.971682, 40.743041], [-73.971889, 40.742725], [-73.971741, 40.742664], [-73.971960, 40.742338], [-73.972290, 40.740721], [-73.972196, 40.740710], [-73.972183, 40.740706], [-73.972168, 40.740693], [-73.972165, 40.740676], [-73.972196, 40.740403], [-73.972217, 40.740308], [-73.972300, 40.740035], [-73.972310, 40.740019], [-73.972331, 40.740011], [-73.972439, 40.740022], [-73.972657, 40.739223], [-73.972657, 40.739221], [-73.972657, 40.739221], [-73.972568, 40.737404], [-73.972490, 40.735803], [-73.972510, 40.735787], [-73.972869, 40.735771], [-73.974414, 40.736414], [-73.974460, 40.736294], [-73.974417, 40.736278], [-73.974412, 40.736285], [-73.974400, 40.736284], [-73.974027, 40.736126], [-73.974047, 40.736100], [-73.974429, 40.736261], [-73.974428, 40.736266], [-73.974466, 40.736278], [-73.974504, 40.736065], [-73.974504, 40.736065], [-73.974475, 40.736062], [-73.974441, 40.736050], [-73.974434, 40.736054], [-73.974141, 40.735956], [-73.974151, 40.735934], [-73.974447, 40.736033], [-73.974448, 40.736038], [-73.974478, 40.736044], [-73.974505, 40.736042], [-73.974515, 40.735895], [-73.974515, 40.735895], [-73.974515, 40.735893], [-73.974508, 40.735797], [-73.974487, 40.735877], [-73.974450, 40.735870], [-73.974461, 40.735832], [-73.974249, 40.735798], [-73.974245, 40.735781], [-73.974258, 40.735767], [-73.974469, 40.735799], [-73.974469, 40.735789], [-73.974477, 40.735789], [-73.974465, 40.735668], [-73.974391, 40.735669], [-73.974391, 40.735673], [-73.974263, 40.735673], [-73.974264, 40.735677], [-73.974192, 40.735681], [-73.974189, 40.735661], [-73.974157, 40.735659], [-73.974145, 40.735673], [-73.974092, 40.735642], [-73.974089, 40.735646], [-73.973419, 40.735368], [-73.973439, 40.735341], [-73.973057, 40.735177], [-73.972807, 40.735524], [-73.972937, 40.735599], [-73.972930, 40.735608], [-73.972763, 40.735505], [-73.972997, 40.735187], [-73.972964, 40.735169], [-73.972932, 40.735205], [-73.972885, 40.735180], [-73.972864, 40.735212], [-73.972837, 40.735200], [-73.972945, 40.735065], [-73.972967, 40.735078], [-73.972945, 40.735108], [-73.972996, 40.735128], [-73.972971, 40.735157], [-73.973003, 40.735173], [-73.973037, 40.735128], [-73.973299, 40.735242], [-73.973299, 40.735241], [-73.973322, 40.735202], [-73.973299, 40.735177], [-73.973279, 40.735148], [-73.973272, 40.735119], [-73.973277, 40.735079], [-73.973296, 40.735041], [-73.973329, 40.735011], [-73.973369, 40.734989], [-73.973418, 40.734971], [-73.973459, 40.734968], [-73.973523, 40.734975], [-73.973545, 40.734944], [-73.974437, 40.735316], [-73.974437, 40.735315], [-73.974437, 40.735315], [-73.974378, 40.735081], [-73.974378, 40.735080], [-73.974648, 40.735082], [-73.974907, 40.735313], [-73.978527, 40.736854], [-73.978527, 40.736855], [-73.978527, 40.736856], [-73.978520, 40.736858], [-73.984742, 40.739503], [-73.983381, 40.741375], [-73.979711, 40.746385], [-73.971682, 40.743041]],
    color: '#0891b2',
  },
  'Cobble Hill': {
    center: [-73.994768, 40.688266],
    coordinates: [[-73.992368, 40.689691], [-73.992623, 40.689161], [-73.991094, 40.688571], [-73.991509, 40.687959], [-73.990035, 40.687365], [-73.991332, 40.685448], [-73.993930, 40.686453], [-73.995232, 40.683741], [-74.000891, 40.685300], [-73.998631, 40.689920], [-73.998637, 40.690376], [-73.998845, 40.690467], [-73.999254, 40.691576], [-73.992368, 40.689691]],
    color: '#059669',
  },
  'Carroll Gardens': {
    center: [-73.995529, 40.681690],
    coordinates: [[-73.991332, 40.685448], [-73.989140, 40.684594], [-73.994596, 40.676572], [-73.996460, 40.677457], [-73.998960, 40.672180], [-74.003414, 40.679705], [-74.000891, 40.685300], [-73.995232, 40.683741], [-73.993930, 40.686453], [-73.991332, 40.685448]],
    color: '#0891b2',
  },
  'Boerum Hill': {
    center: [-73.986973, 40.687326],
    coordinates: [[-73.979903, 40.687466], [-73.978026, 40.684864], [-73.978033, 40.684853], [-73.980051, 40.681860], [-73.988712, 40.685224], [-73.989140, 40.684594], [-73.991332, 40.685448], [-73.990035, 40.687365], [-73.991509, 40.687959], [-73.991094, 40.688571], [-73.992623, 40.689161], [-73.992368, 40.689691], [-73.992012, 40.690432], [-73.991742, 40.690993], [-73.986196, 40.688999], [-73.985854, 40.689602], [-73.979903, 40.687466]],
    color: '#0284c7',
  },
  'Fort Greene': {
    center: [-73.977006, 40.690165],
    coordinates: [[-73.970773, 40.697840], [-73.967477, 40.681750], [-73.973780, 40.683061], [-73.975930, 40.683505], [-73.977431, 40.684043], [-73.978026, 40.684864], [-73.979903, 40.687466], [-73.980881, 40.688838], [-73.982631, 40.692224], [-73.982419, 40.695973], [-73.980507, 40.696498], [-73.980544, 40.698246], [-73.970773, 40.697840]],
    color: '#7c3aed',
  },
  'Prospect Heights': {
    center: [-73.968950, 40.676488],
    coordinates: [[-73.967477, 40.681750], [-73.964389, 40.681105], [-73.963331, 40.675561], [-73.962770, 40.672651], [-73.962596, 40.671630], [-73.967474, 40.672863], [-73.968889, 40.672961], [-73.968822, 40.673133], [-73.968746, 40.673486], [-73.968709, 40.673938], [-73.968810, 40.674342], [-73.969000, 40.674716], [-73.969281, 40.675098], [-73.969697, 40.675399], [-73.970037, 40.675522], [-73.970430, 40.675539], [-73.970776, 40.675445], [-73.971050, 40.675237], [-73.977431, 40.684043], [-73.975930, 40.683505], [-73.973780, 40.683061], [-73.967477, 40.681750]],
    color: '#c026d3',
  },
  'Clinton Hill': {
    center: [-73.962586, 40.686438],
    coordinates: [[-73.958396, 40.680798], [-73.958237, 40.680008], [-73.958292, 40.679831], [-73.964389, 40.681105], [-73.967477, 40.681750], [-73.970773, 40.697840], [-73.965418, 40.697628], [-73.961899, 40.698188], [-73.958396, 40.680798]],
    color: '#9333ea',
  },
  'Bedford-Stuyvesant': {
    center: [-73.938262, 40.687085],
    coordinates: [[-73.941149, 40.700281], [-73.905479, 40.680039], [-73.905479, 40.680039], [-73.907860, 40.678134], [-73.908088, 40.676190], [-73.952432, 40.678611], [-73.958292, 40.679831], [-73.958237, 40.680008], [-73.958396, 40.680798], [-73.961899, 40.698188], [-73.957020, 40.698974], [-73.941931, 40.700725], [-73.941149, 40.700281]],
    color: '#16a34a',
  },
  'Red Hook': {
    center: [-74.006500, 40.675000],
    coordinates: [[-74.003414, 40.679705], [-73.998960, 40.672180], [-73.998660, 40.671705], [-73.998769, 40.671602], [-73.998926, 40.671415], [-73.999311, 40.670773], [-73.999628, 40.670113], [-73.999911, 40.669499], [-74.000303, 40.668717], [-74.000766, 40.668857], [-74.001057, 40.668946], [-74.002134, 40.668556], [-74.002895, 40.667348], [-74.003191, 40.667263], [-74.003695, 40.667428], [-74.006257, 40.667596], [-74.006803, 40.668591], [-74.007548, 40.667052], [-74.007797, 40.667160], [-74.007087, 40.668591], [-74.007950, 40.668570], [-74.011274, 40.665628], [-74.012345, 40.664987], [-74.016903, 40.664847], [-74.017444, 40.665268], [-74.017887, 40.665850], [-74.018576, 40.670392], [-74.019339, 40.671625], [-74.017510, 40.671035], [-74.015938, 40.665467], [-74.012280, 40.665732], [-74.010877, 40.668602], [-74.010338, 40.669078], [-74.010560, 40.669191], [-74.011543, 40.669785], [-74.011625, 40.670581], [-74.014062, 40.669706], [-74.014242, 40.669808], [-74.011754, 40.670658], [-74.012620, 40.670842], [-74.013552, 40.671257], [-74.015080, 40.670686], [-74.015200, 40.670754], [-74.013873, 40.671881], [-74.015596, 40.670970], [-74.015686, 40.671039], [-74.014287, 40.672241], [-74.012976, 40.673328], [-74.015075, 40.672193], [-74.015926, 40.672661], [-74.014579, 40.674414], [-74.016776, 40.673129], [-74.018168, 40.671939], [-74.018801, 40.672251], [-74.017271, 40.673609], [-74.017752, 40.674048], [-74.018115, 40.674343], [-74.018045, 40.674768], [-74.017924, 40.675076], [-74.017834, 40.675258], [-74.018150, 40.675468], [-74.018412, 40.675365], [-74.018753, 40.675062], [-74.018881, 40.675092], [-74.018409, 40.675524], [-74.018503, 40.675842], [-74.018018, 40.675890], [-74.017912, 40.676510], [-74.019110, 40.676546], [-74.019952, 40.677103], [-74.019083, 40.677140], [-74.019189, 40.677741], [-74.018430, 40.677908], [-74.018411, 40.678407], [-74.019472, 40.678358], [-74.019662, 40.678386], [-74.019552, 40.678482], [-74.018816, 40.678452], [-74.018565, 40.678440], [-74.018405, 40.678442], [-74.018283, 40.678728], [-74.018579, 40.678983], [-74.019440, 40.678933], [-74.019556, 40.679017], [-74.019281, 40.679648], [-74.018928, 40.679844], [-74.018991, 40.679905], [-74.017725, 40.680662], [-74.017469, 40.680615], [-74.015387, 40.681867], [-74.014390, 40.681341], [-74.012300, 40.679731], [-74.009543, 40.681745], [-74.007560, 40.683737], [-74.005675, 40.682930], [-74.004473, 40.680990], [-74.003414, 40.679705]],
    color: '#dc2626',
  },
}

export interface VenueMarker {
  id: string
  lat: number
  lng: number
  label?: string
}

export interface MapBounds {
  ne: { lat: number; lng: number }
  sw: { lat: number; lng: number }
}

export type MapLocationMode = 'neighborhoods' | 'radius' | 'map_area'

interface NeighborhoodPickerProps {
  selected: string[]
  onChange: (neighborhoods: string[]) => void
  height?: string
  className?: string
  markers?: VenueMarker[]
  hideFooter?: boolean
  // Location mode
  locationMode?: MapLocationMode
  radiusMiles?: number // For radius mode
  radiusCenter?: { lat: number; lng: number } // Draggable center for radius mode
  onRadiusCenterChange?: (center: { lat: number; lng: number }) => void
  // Map movement callbacks
  onCenterChange?: (center: { lat: number; lng: number }) => void
  onBoundsChange?: (bounds: MapBounds) => void
  // Marker click callback
  onMarkerClick?: (markerId: string) => void
}

export function NeighborhoodPicker({
  selected,
  onChange,
  height = '400px',
  className = '',
  markers = [],
  hideFooter = false,
  locationMode = 'neighborhoods',
  radiusMiles = 1,
  radiusCenter,
  onRadiusCenterChange,
  onCenterChange,
  onBoundsChange,
  onMarkerClick,
}: NeighborhoodPickerProps) {
  const mapContainer = useRef<HTMLDivElement>(null)
  const mapRef = useRef<any>(null)
  const mapboxglRef = useRef<any>(null)
  const markersRef = useRef<Map<string, any>>(new Map())
  const radiusCenterMarkerRef = useRef<any>(null)
  const [mapReady, setMapReady] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [hoveredNeighborhood, setHoveredNeighborhood] = useState<string | null>(null)
  const [internalRadiusCenter, setInternalRadiusCenter] = useState<{ lat: number; lng: number }>({ lat: 40.735, lng: -73.985 })

  // Use prop if provided, otherwise use internal state
  const effectiveRadiusCenter = radiusCenter || internalRadiusCenter

  // Refs to store current values for use in Mapbox event handlers (to avoid stale closures)
  const selectedRef = useRef(selected)
  const onChangeRef = useRef(onChange)
  const onCenterChangeRef = useRef(onCenterChange)
  const onBoundsChangeRef = useRef(onBoundsChange)
  const onRadiusCenterChangeRef = useRef(onRadiusCenterChange)
  const locationModeRef = useRef(locationMode)

  // Keep refs up to date
  useEffect(() => {
    selectedRef.current = selected
  }, [selected])

  useEffect(() => {
    locationModeRef.current = locationMode
  }, [locationMode])

  useEffect(() => {
    onRadiusCenterChangeRef.current = onRadiusCenterChange
  }, [onRadiusCenterChange])

  useEffect(() => {
    onCenterChangeRef.current = onCenterChange
    onBoundsChangeRef.current = onBoundsChange
  }, [onCenterChange, onBoundsChange])

  useEffect(() => {
    onChangeRef.current = onChange
  }, [onChange])

  const accessToken = process.env.NEXT_PUBLIC_MAPBOX_TOKEN

  // Initialize map
  useEffect(() => {
    if (typeof window === 'undefined') return
    if (!mapContainer.current) return
    if (mapRef.current) return
    if (!accessToken) return

    let isMounted = true

    const initMap = async () => {
      try {
        const mapboxModule = await import('mapbox-gl')
        const mapboxgl = mapboxModule.default
        await import('mapbox-gl/dist/mapbox-gl.css')

        if (!isMounted || !mapContainer.current) return

        mapboxglRef.current = mapboxgl
        mapboxgl.accessToken = accessToken

        const map = new mapboxgl.Map({
          container: mapContainer.current,
          style: 'mapbox://styles/mapbox/light-v11',
          center: [-73.985, 40.735],
          zoom: 11.5,
          minZoom: 10,
          maxZoom: 15,
        })

        mapRef.current = map

        map.on('load', () => {
          if (isMounted) {
            setMapReady(true)
            addNeighborhoodLayers(map)

            // Emit initial center and bounds
            const center = map.getCenter()
            const bounds = map.getBounds()
            if (onCenterChangeRef.current) {
              onCenterChangeRef.current({ lat: center.lat, lng: center.lng })
            }
            if (onBoundsChangeRef.current && bounds) {
              onBoundsChangeRef.current({
                ne: { lat: bounds.getNorth(), lng: bounds.getEast() },
                sw: { lat: bounds.getSouth(), lng: bounds.getWest() },
              })
            }
          }
        })

        // Emit center and bounds on map move
        map.on('moveend', () => {
          const center = map.getCenter()
          const bounds = map.getBounds()
          if (onCenterChangeRef.current) {
            onCenterChangeRef.current({ lat: center.lat, lng: center.lng })
          }
          if (onBoundsChangeRef.current && bounds) {
            onBoundsChangeRef.current({
              ne: { lat: bounds.getNorth(), lng: bounds.getEast() },
              sw: { lat: bounds.getSouth(), lng: bounds.getWest() },
            })
          }
        })

        map.on('error', (e: any) => {
          console.error('Mapbox error:', e.error)
          setError('Failed to load map')
        })

        // Add navigation controls
        map.addControl(new mapboxgl.NavigationControl(), 'top-right')
      } catch (err) {
        console.error('Failed to load Mapbox:', err)
        if (isMounted) {
          setError('Failed to load map')
        }
      }
    }

    initMap()

    return () => {
      isMounted = false
      if (mapRef.current) {
        mapRef.current.remove()
        mapRef.current = null
      }
    }
  }, [accessToken])

  // ResizeObserver to handle container size changes (e.g., sidebar toggle)
  useEffect(() => {
    if (!mapContainer.current || !mapRef.current) return

    const resizeObserver = new ResizeObserver(() => {
      // Use requestAnimationFrame to debounce and ensure smooth resize
      requestAnimationFrame(() => {
        if (mapRef.current) {
          mapRef.current.resize()
        }
      })
    })

    resizeObserver.observe(mapContainer.current)

    return () => {
      resizeObserver.disconnect()
    }
  }, [mapReady]) // Re-run when map is ready

  // Add neighborhood layers
  const addNeighborhoodLayers = (map: any) => {
    Object.entries(NYC_NEIGHBORHOOD_BOUNDS).forEach(([name, data]) => {
      const sourceId = `neighborhood-${name}`
      const fillLayerId = `${sourceId}-fill`
      const outlineLayerId = `${sourceId}-outline`
      const labelLayerId = `${sourceId}-label`

      // Add source with real polygon coordinates
      map.addSource(sourceId, {
        type: 'geojson',
        data: {
          type: 'Feature',
          geometry: {
            type: 'Polygon',
            coordinates: [data.coordinates],
          },
          properties: { name },
        },
      })

      // Add fill layer - start with very low opacity for unselected state
      map.addLayer({
        id: fillLayerId,
        type: 'fill',
        source: sourceId,
        paint: {
          'fill-color': data.color,
          'fill-opacity': 0.08,
        },
      })

      // Add outline layer - start with low opacity for unselected state
      map.addLayer({
        id: outlineLayerId,
        type: 'line',
        source: sourceId,
        paint: {
          'line-color': data.color,
          'line-width': 1.5,
          'line-opacity': 0.25,
        },
      })

      // Add label
      map.addSource(`${sourceId}-point`, {
        type: 'geojson',
        data: {
          type: 'Feature',
          geometry: {
            type: 'Point',
            coordinates: data.center,
          },
          properties: { name },
        },
      })

      map.addLayer({
        id: labelLayerId,
        type: 'symbol',
        source: `${sourceId}-point`,
        layout: {
          'text-field': name,
          'text-size': 12,
          'text-font': ['DIN Pro Medium', 'Arial Unicode MS Bold'],
          'text-anchor': 'center',
        },
        paint: {
          'text-color': '#333',
          'text-halo-color': '#fff',
          'text-halo-width': 1.5,
        },
      })

      // Click handler - use refs to avoid stale closure issues
      // Only allow clicks when in neighborhoods mode
      map.on('click', fillLayerId, () => {
        if (locationModeRef.current !== 'neighborhoods') return
        const currentSelected = selectedRef.current
        const newSelected = currentSelected.includes(name)
          ? currentSelected.filter((n) => n !== name)
          : [...currentSelected, name]
        onChangeRef.current(newSelected)
      })

      // Hover handlers - only show hover in neighborhoods mode
      map.on('mouseenter', fillLayerId, () => {
        if (locationModeRef.current !== 'neighborhoods') return
        map.getCanvas().style.cursor = 'pointer'
        setHoveredNeighborhood(name)
      })

      map.on('mouseleave', fillLayerId, () => {
        map.getCanvas().style.cursor = ''
        setHoveredNeighborhood(null)
      })
    })
  }

  // Update layer styles when selection changes or mode changes
  useEffect(() => {
    if (!mapRef.current || !mapReady) return

    const map = mapRef.current
    const showNeighborhoods = locationMode === 'neighborhoods'

    Object.entries(NYC_NEIGHBORHOOD_BOUNDS).forEach(([name, data]) => {
      const fillLayerId = `neighborhood-${name}-fill`
      const outlineLayerId = `neighborhood-${name}-outline`
      const labelLayerId = `neighborhood-${name}-label`

      const isSelected = selected.includes(name)
      const isHovered = hoveredNeighborhood === name

      try {
        if (showNeighborhoods) {
          // Show neighborhoods - much higher contrast: selected is vivid, unselected is barely visible
          map.setPaintProperty(fillLayerId, 'fill-opacity', isSelected ? 0.55 : isHovered ? 0.25 : 0.08)
          map.setPaintProperty(outlineLayerId, 'line-width', isSelected ? 3 : isHovered ? 2 : 1.5)
          map.setPaintProperty(outlineLayerId, 'line-opacity', isSelected ? 1 : isHovered ? 0.5 : 0.25)
          map.setLayoutProperty(labelLayerId, 'visibility', 'visible')
        } else {
          // Hide neighborhoods in other modes
          map.setPaintProperty(fillLayerId, 'fill-opacity', 0)
          map.setPaintProperty(outlineLayerId, 'line-opacity', 0)
          map.setLayoutProperty(labelLayerId, 'visibility', 'none')
        }
      } catch {
        // Layer may not exist yet
      }
    })
  }, [selected, hoveredNeighborhood, mapReady, locationMode])

  // Draw radius circle when in radius mode
  useEffect(() => {
    if (!mapRef.current || !mapReady) return
    const map = mapRef.current

    const sourceId = 'radius-circle'
    const fillLayerId = 'radius-circle-fill'
    const outlineLayerId = 'radius-circle-outline'

    // Remove existing radius layers
    try {
      if (map.getLayer(fillLayerId)) map.removeLayer(fillLayerId)
      if (map.getLayer(outlineLayerId)) map.removeLayer(outlineLayerId)
      if (map.getSource(sourceId)) map.removeSource(sourceId)
    } catch {
      // Layers may not exist
    }

    // Only draw in radius mode
    if (locationMode !== 'radius') return

    // Create a GeoJSON circle (approximation using 64 points)
    const radiusInMeters = radiusMiles * 1609.34 // Convert miles to meters
    const points = 64
    const coords = []
    const km = radiusInMeters / 1000
    const distanceX = km / (111.32 * Math.cos((effectiveRadiusCenter.lat * Math.PI) / 180))
    const distanceY = km / 110.574

    for (let i = 0; i < points; i++) {
      const theta = (i / points) * (2 * Math.PI)
      const x = distanceX * Math.cos(theta)
      const y = distanceY * Math.sin(theta)
      coords.push([effectiveRadiusCenter.lng + x, effectiveRadiusCenter.lat + y])
    }
    coords.push(coords[0]) // Close the circle

    const circleData = {
      type: 'Feature' as const,
      geometry: {
        type: 'Polygon' as const,
        coordinates: [coords],
      },
      properties: {},
    }

    // Add source and layers
    map.addSource(sourceId, {
      type: 'geojson',
      data: circleData,
    })

    map.addLayer({
      id: fillLayerId,
      type: 'fill',
      source: sourceId,
      paint: {
        'fill-color': '#3b82f6',
        'fill-opacity': 0.15,
      },
    })

    map.addLayer({
      id: outlineLayerId,
      type: 'line',
      source: sourceId,
      paint: {
        'line-color': '#3b82f6',
        'line-width': 2,
        'line-dasharray': [2, 2],
      },
    })
  }, [locationMode, radiusMiles, effectiveRadiusCenter, mapReady])

  // Manage draggable center marker for radius mode
  useEffect(() => {
    if (!mapRef.current || !mapReady || !mapboxglRef.current) return

    const mapboxgl = mapboxglRef.current

    // Remove existing center marker if any
    if (radiusCenterMarkerRef.current) {
      radiusCenterMarkerRef.current.remove()
      radiusCenterMarkerRef.current = null
    }

    // Only show marker in radius mode
    if (locationMode !== 'radius') return

    // Create a custom marker element
    const el = document.createElement('div')
    el.className = 'radius-center-marker'
    el.style.cssText = `
      width: 24px;
      height: 24px;
      background: #3b82f6;
      border: 3px solid white;
      border-radius: 50%;
      cursor: grab;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      transition: transform 0.1s ease;
    `

    // Add hover effect
    el.addEventListener('mouseenter', () => {
      el.style.transform = 'scale(1.15)'
    })
    el.addEventListener('mouseleave', () => {
      el.style.transform = 'scale(1)'
    })

    // Create draggable marker
    const marker = new mapboxgl.Marker({
      element: el,
      draggable: true,
    })
      .setLngLat([effectiveRadiusCenter.lng, effectiveRadiusCenter.lat])
      .addTo(mapRef.current)

    // Handle drag events
    marker.on('dragstart', () => {
      el.style.cursor = 'grabbing'
    })

    marker.on('drag', () => {
      const lngLat = marker.getLngLat()
      const newCenter = { lat: lngLat.lat, lng: lngLat.lng }
      setInternalRadiusCenter(newCenter)
      if (onRadiusCenterChangeRef.current) {
        onRadiusCenterChangeRef.current(newCenter)
      }
    })

    marker.on('dragend', () => {
      el.style.cursor = 'grab'
      const lngLat = marker.getLngLat()
      const newCenter = { lat: lngLat.lat, lng: lngLat.lng }
      setInternalRadiusCenter(newCenter)
      if (onRadiusCenterChangeRef.current) {
        onRadiusCenterChangeRef.current(newCenter)
      }
    })

    radiusCenterMarkerRef.current = marker

    return () => {
      if (radiusCenterMarkerRef.current) {
        radiusCenterMarkerRef.current.remove()
        radiusCenterMarkerRef.current = null
      }
    }
  }, [locationMode, mapReady])

  // Update marker position when effectiveRadiusCenter changes externally
  useEffect(() => {
    if (radiusCenterMarkerRef.current && locationMode === 'radius') {
      const currentPos = radiusCenterMarkerRef.current.getLngLat()
      if (currentPos.lat !== effectiveRadiusCenter.lat || currentPos.lng !== effectiveRadiusCenter.lng) {
        radiusCenterMarkerRef.current.setLngLat([effectiveRadiusCenter.lng, effectiveRadiusCenter.lat])
      }
    }
  }, [effectiveRadiusCenter, locationMode])


  // Update venue markers when markers prop changes
  useEffect(() => {
    if (!mapRef.current || !mapReady || !mapboxglRef.current) return

    const mapboxgl = mapboxglRef.current
    const existingMarkerIds = new Set(markersRef.current.keys())
    const newMarkerIds = new Set(markers.map((m) => m.id))

    // Remove markers that are no longer in the list
    existingMarkerIds.forEach((id) => {
      if (!newMarkerIds.has(id)) {
        const marker = markersRef.current.get(id)
        if (marker) {
          marker.remove()
          markersRef.current.delete(id)
        }
      }
    })

    // Add new markers
    markers.forEach((m) => {
      if (!markersRef.current.has(m.id)) {
        // Create Airbnb-style pill marker (same as vendors page)
        const el = m.label
          ? createMarkerElement({ label: m.label, isSelected: false })
          : (() => {
              // Fallback to simple dot if no label
              const dot = document.createElement('div')
              dot.className = 'venue-marker'
              dot.style.width = '12px'
              dot.style.height = '12px'
              dot.style.backgroundColor = '#ef4444'
              dot.style.borderRadius = '50%'
              dot.style.border = '2px solid white'
              dot.style.boxShadow = '0 2px 4px rgba(0,0,0,0.3)'
              dot.style.cursor = 'pointer'
              return dot
            })()

        // Add click handler
        if (onMarkerClick) {
          el.addEventListener('click', (e) => {
            e.stopPropagation()
            onMarkerClick(m.id)
          })
        }

        const marker = new mapboxgl.Marker({ element: el })
          .setLngLat([m.lng, m.lat])
          .addTo(mapRef.current)

        markersRef.current.set(m.id, marker)
      }
    })
  }, [markers, mapReady, onMarkerClick])

  if (!accessToken) {
    return (
      <div
        className={`flex flex-col items-center justify-center bg-muted rounded-md p-4 ${className}`}
        style={{ height }}
      >
        <p className="text-sm font-medium text-muted-foreground mb-2">
          Mapbox not configured
        </p>
        <p className="text-xs text-muted-foreground text-center">
          Add NEXT_PUBLIC_MAPBOX_TOKEN to your .env.local file
        </p>
      </div>
    )
  }

  if (error) {
    return (
      <div
        className={`flex flex-col items-center justify-center bg-destructive/10 rounded-md p-4 ${className}`}
        style={{ height }}
      >
        <p className="text-sm font-medium text-destructive">{error}</p>
      </div>
    )
  }

  return (
    <div className={`${hideFooter ? 'h-full' : 'space-y-2'} ${className}`}>
      <div className={`relative ${hideFooter ? 'h-full' : ''}`}>
        <div
          ref={mapContainer}
          className={`overflow-hidden bg-muted ${hideFooter ? 'h-full' : 'rounded-md'}`}
          style={hideFooter ? undefined : { height }}
        />
      </div>
      {!hideFooter && (
        <p className="text-xs text-muted-foreground">
          {selected.length === 0
            ? 'Click on neighborhoods to select them, or leave empty to find restaurants across all of NYC'
            : `Finding restaurants in: ${selected.join(', ')}`}
        </p>
      )}
    </div>
  )
}
